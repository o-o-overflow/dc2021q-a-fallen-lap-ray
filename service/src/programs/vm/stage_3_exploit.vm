
stk 0 i
# current stack now has this instruction pointer
# next line is debug
# ldm a s

# push two spaces onto the stack so that we don't overwrite saved ip
imm a 0
stk 0 a
stk 0 a
add a s

# push quit on the buffer, going to race to change the flag
imm b 0x7571
stm a b

imm c 2
add a c

imm b 0x7469
stm a b

# Address of fname goes into b
imm b 0
add b s

# &flags in the same buffer, and goes in d
imm d 0x0
add d b

imm c 1
imm a 0

sys 0x3 d

# pop off the stack
stk a 0
stk a 0

# Try to write out "s" to the fd

# buf in b
imm b 0x73
stk 0 b 
imm b 0
add b s

# len in c
imm c 0x1

# fd in a
imm a 11

sys write d

# clear the stack
stk a 0

# c has where we want to jump to
stk c 0
stk 0 c
imm a 1
cmp d a
jmp != c

sys exit d



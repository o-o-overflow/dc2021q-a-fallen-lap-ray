
stk 0 i
# current stack now has this instruction pointer
# next line is debug
# ldm a s

# push two spaces onto the stack so that we don't overwrite saved ip
imm a 0
stk 0 a
stk 0 a
add a s

# push alag on the buffer, going to race to change
imm b 0x6c61
stm a b

imm c 2
add a c

imm b 0x6761
stm a b

# Address of fname goes into b
imm b 0
add b s

# &flags in reg d
imm d 0x0
stk 0 d
add d s

imm c 1
imm a 0

sys 0x3 d

# pop off the stack
stk a 0
stk a 0
stk a 0

imm a 11

# Read and print out the flag, a has the fd

# buf in b
imm b 0
add b s

# len in c
imm c 0xff

# fd in a

sys read c

imm a 1

sys write d


# c has where we want to jump to
stk c 0
stk 0 c
imm a 1
cmp d a
jmp < c

sys exit d


